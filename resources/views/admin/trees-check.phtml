<?php

use Fisharebest\Webtrees\Http\RequestHandlers\ControlPanel;
use Fisharebest\Webtrees\Http\RequestHandlers\ManageTrees;
use Fisharebest\Webtrees\I18N;
use Fisharebest\Webtrees\Tree;
use Fisharebest\Webtrees\View;

/**
 * @var array<string> $errors
 * @var array<string> $infos
 * @var string        $more_url
 * @var string        $title
 * @var Tree          $tree
 * @var array<string> $warnings
 */

?>

<?= view('components/breadcrumbs', ['links' => [route(ControlPanel::class) => I18N::translate('Control panel'), route(ManageTrees::class, ['tree' => $tree->name()]) => I18N::translate('Manage family trees'), $title]]) ?>

<h1><?= $title ?></h1>

<h2>
    <?= I18N::translate('GEDCOM errors') ?>
</h2>

<ul class="list-group">
    <?php foreach ($errors as $error) : ?>
        <li class="list-group-item list-group-item-danger" data-wt-tag="<?= e($error->tag) ?>">
            <?php if ($error->tag !== '') : ?>
                <button type="button" class="btn btn-sm btn-link float-end" title="<?= e($error->tag) ?>">
                    <?= I18N::translate('Hide these errors') ?>
                </button>
            <?php endif ?>

            <?= $error->message ?>
        </li>
    <?php endforeach ?>

    <?php foreach ($warnings as $warning) : ?>
        <li class="list-group-item list-group-item-warning" data-wt-tag="<?= e($warning->tag) ?>">
            <?php if ($warning->tag !== '') : ?>
            <button type="button" class="btn btn-sm btn-link float-end" title="<?= e($warning->tag) ?>">
                <?= I18N::translate('Hide these errors') ?>
            </button>
            <?php endif ?>

            <?= $warning->message ?>
        </li>
    <?php endforeach ?>

    <?php foreach ($infos as $info) : ?>
        <li class="list-group-item list-group-item-info" data-wt-tag="<?= e($info->tag) ?>">
            <?php if ($info->tag !== '') : ?>
            <button type="button" class="btn btn-sm btn-link float-end" title="<?= e($info->tag) ?>">
                <?= I18N::translate('Hide these errors') ?>
            </button>
            <?php endif ?>

            <?= $info->message ?>
        </li>
    <?php endforeach ?>

    <?php if ($errors === [] && $warnings === []) : ?>
        <li class="list-group-item"><?= I18N::translate('No errors have been found.') ?></li>
    <?php endif ?>
</ul>

<?php if ($more_url !== '') : ?>
    <p>
        <?= I18N::translate('The serverâ€™s time limit has been reached.') ?>
        <a class="btn btn-primary" href="<?= e($more_url) ?>">
            <?= I18N::translate('show more') ?>
        </a>
    </p>
<?php endif ?>

<?php View::push('javascript') ?>
<script>
  'use strict';

  document.querySelector('ul.list-group').addEventListener('click', (event) => {
    if (event.target.matches('button')) {
      event.preventDefault();
      event.stopPropagation();

      // Much quicker to hide elements than remove them.
      document
        .querySelectorAll('[data-wt-tag=' + CSS.escape(event.target.closest('li').dataset.wtTag) + ']')
        .forEach((element) => { element.style.display = 'none'; });
    }
  });
</script>
<?php View::endpush() ?>
